<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cashmop — Import Flow v2 Mock (Below Preview Controls)</title>
    <style>
      :root {
        --bg: #f9f8f6;
        --card: #ffffff;
        --border: #f2f0ed;
        --muted: #736f6a;
        --text: #2c2a27;
        --brand: #0d9488;
        --brand-weak: rgba(13, 148, 136, 0.12);
        --danger: #dc2626;
        --income: #16a34a;
        --expense: #dc2626;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family:
          ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Helvetica,
          Arial,
          "Apple Color Emoji",
          "Segoe UI Emoji";
        background: var(--bg);
        color: var(--text);
      }

      .app {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px;
      }

      .topbar {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 12px 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: var(--bg);
        color: var(--muted);
        font-size: 12px;
      }

      .tag strong {
        color: var(--text);
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 12px;
        border: 1px solid rgba(13, 148, 136, 0.25);
        background: var(--brand-weak);
        color: var(--brand);
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
      }

      .dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: var(--brand);
      }

      .auto-indicator {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: var(--muted);
        font-weight: 700;
        user-select: none;
        white-space: nowrap;
      }

      .auto-indicator .auto-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: var(--brand);
        opacity: 0.55;
      }

      .layout {
        margin-top: 14px;
        display: grid;
        grid-template-columns: 420px 1fr;
        gap: 12px;
        align-items: start;
      }

      .right-stack {
        display: grid;
        gap: 12px;
        align-items: start;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 12px;
      }

      .card h2 {
        margin: 0;
        font-size: 14px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--muted);
      }

      .section {
        margin-top: 10px;
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 10px;
        background: #fff;
      }

      .section h3 {
        margin: 0 0 8px;
        font-size: 13px;
      }

      .muted {
        color: var(--muted);
        font-size: 12px;
        line-height: 1.35;
      }

      .row {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        align-items: center;
      }

      label {
        font-size: 12px;
        color: var(--muted);
        display: block;
        margin-bottom: 6px;
      }

      input[type="text"],
      select {
        width: 100%;
        padding: 8px 10px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: #fff;
        font-size: 13px;
      }

      .seg {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
      }

      .seg button {
        appearance: none;
        border: 1px solid var(--border);
        background: var(--bg);
        border-radius: 12px;
        padding: 8px 10px;
        font-size: 13px;
        cursor: pointer;
        color: var(--text);
      }

      .seg button[aria-pressed="true"] {
        border-color: rgba(13, 148, 136, 0.35);
        background: var(--brand-weak);
        color: var(--brand);
        font-weight: 700;
      }

      .months {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 8px;
      }

      .chip {
        border: 1px solid var(--border);
        background: var(--bg);
        padding: 7px 9px;
        border-radius: 999px;
        font-size: 12px;
        cursor: pointer;
        user-select: none;
      }

      .chip[data-selected="true"] {
        border-color: rgba(13, 148, 136, 0.35);
        background: var(--brand-weak);
        color: var(--brand);
        font-weight: 700;
      }

      .desc-list {
        list-style: none;
        padding: 0;
        margin: 8px 0 0;
        display: grid;
        gap: 6px;
      }

      .desc-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 8px 10px;
        border: 1px solid var(--border);
        border-radius: 12px;
        background: var(--bg);
        cursor: grab;
      }

      .desc-item span {
        font-family:
          ui-monospace,
          SFMono-Regular,
          Menlo,
          Monaco,
          Consolas,
          "Liberation Mono",
          "Courier New",
          monospace;
        font-size: 12px;
      }

      .mini-btn {
        border: 1px solid var(--border);
        background: #fff;
        border-radius: 10px;
        padding: 6px 8px;
        font-size: 12px;
        cursor: pointer;
      }

      .cta {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
        margin-top: 10px;
      }

      .primary {
        border: 1px solid rgba(13, 148, 136, 0.35);
        background: var(--brand);
        color: #fff;
        border-radius: 14px;
        padding: 10px 12px;
        font-weight: 800;
        cursor: pointer;
      }

      .primary[disabled] {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .secondary {
        border: 1px solid var(--border);
        background: #fff;
        color: var(--text);
        border-radius: 14px;
        padding: 10px 12px;
        font-weight: 700;
        cursor: pointer;
      }

      .danger {
        color: var(--danger);
        font-weight: 700;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead th {
        position: sticky;
        top: 0;
        background: var(--bg);
        border-bottom: 1px solid var(--border);
        padding: 8px 10px;
        text-align: left;
        vertical-align: top;
        min-width: 160px;
      }

      tbody td {
        border-bottom: 1px solid var(--border);
        padding: 8px 10px;
        color: #4a4743;
        font-size: 13px;
        white-space: nowrap;
      }

      .amt {
        font-family:
          ui-monospace,
          SFMono-Regular,
          Menlo,
          Monaco,
          Consolas,
          "Liberation Mono",
          "Courier New",
          monospace;
        font-weight: 800;
        letter-spacing: -0.01em;
      }

      .amt.income {
        color: var(--income);
      }

      .amt.expense {
        color: var(--expense);
      }

      .col-title {
        font-weight: 800;
        font-size: 12px;
        margin-bottom: 6px;
      }

      .col-controls {
        display: grid;
        gap: 6px;
      }

      .inline {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .tiny-toggle {
        border: 1px solid rgba(13, 148, 136, 0.25);
        background: var(--brand-weak);
        color: var(--brand);
        border-radius: 999px;
        padding: 6px 8px;
        font-size: 11px;
        font-weight: 800;
        cursor: pointer;
        user-select: none;
      }

      .tiny-toggle[data-on="false"] {
        border-color: var(--border);
        background: #fff;
        color: var(--muted);
        font-weight: 700;
      }

      .banner {
        margin-top: 10px;
        border: 1px solid rgba(13, 148, 136, 0.25);
        background: var(--brand-weak);
        color: var(--brand);
        border-radius: 14px;
        padding: 10px 12px;
        font-size: 12px;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .banner button {
        border: 1px solid rgba(13, 148, 136, 0.3);
        background: #fff;
        color: var(--brand);
        border-radius: 12px;
        padding: 8px 10px;
        font-weight: 800;
        cursor: pointer;
      }

      .small {
        font-size: 11px;
        color: var(--muted);
      }

      .hint {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 16px;
        height: 16px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: #fff;
        color: var(--muted);
        font-size: 11px;
        font-weight: 800;
        cursor: help;
        user-select: none;
        flex: 0 0 auto;
      }

      @media (max-width: 1100px) {
        .layout {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!--
      This is a static-ish HTML mock for discussion. It intentionally does NOT match exact Cashmop components.

      Key ideas illustrated:
      - One screen does mapping + month selection + import
      - Mapping preset picker + auto-matched banner + "None (start fresh)"
      - Column role dropdowns above each preview column
      - Amount mapping is inferred from column roles (no explicit “mode”)
      - Plain-language roles: Money (signed) (dynamic when Direction is mapped) / Money out / Money in / Direction (in/out)
      - Single-amount flip toggle near its dropdown (compact "±" control)
      - Description order drag/drop list (not table column DnD)
      - Multi-file is sequential punch-through: import current file -> next file (no back button)

      Variant idea:
      - Preview shows up to 5 rows, so we move Months + Remember mapping + Import CTA under the preview to reclaim sidebar height.
    -->
    <div class="app">
      <div class="topbar">
        <div class="row">
          <span class="pill"><span class="dot"></span> Import flow v2 (mock)</span>
          <span class="tag"><strong>File</strong> <span id="fileName">rbc_export.csv</span></span>
          <span class="tag"><strong>Progress</strong> <span id="fileProgress">File 1 of 2</span></span>
        </div>
      </div>

      <div class="layout">
        <div class="card">
          <h2>Mapping</h2>

          <div class="section">
            <h3>Mapping preset</h3>
            <div class="row">
              <div style="flex: 1; min-width: 220px">
                <label>Search saved mappings</label>
                <input id="presetInput" type="text" list="presetList" value="RBC Checking" />
                <datalist id="presetList">
                  <option value="None (start fresh)"></option>
                  <option value="RBC Checking"></option>
                  <option value="Wise Personal"></option>
                  <option value="AMEX Canada"></option>
                  <option value="TD Credit Card"></option>
                </datalist>
              </div>
              <div style="display: flex; align-items: end">
                <span class="auto-indicator" title="Auto-matched from saved mappings">
                  <span class="auto-dot"></span>
                  <span>Auto-matched</span>
                </span>
              </div>
            </div>
            <!--
              Optional banner shown only when heuristic prefill runs (no auto-match).
              <div class="banner">
                Pre-filled from headers — review quickly.
              </div>
            -->
          </div>

          <div class="section">
            <h3>Account (required)</h3>
            <label>Static account (searchable)</label>
            <input type="text" value="Checking" />
          </div>

          <div class="section">
            <div class="row" style="justify-content: space-between; margin-bottom: 8px">
              <h3 style="margin: 0">Description order</h3>
              <span
                class="hint"
                title="Select description columns in the table (merchant, address, memo...). Reorder them here to control how Cashmop combines them."
                >?</span
              >
            </div>
            <ul class="desc-list" id="descList">
              <li class="desc-item" draggable="true" data-key="Payee">
                <span>Payee</span>
                <button class="mini-btn" type="button">Remove</button>
              </li>
              <li class="desc-item" draggable="true" data-key="Memo">
                <span>Memo</span>
                <button class="mini-btn" type="button">Remove</button>
              </li>
            </ul>
          </div>

          <div class="section">
            <h3>Owner (optional, static)</h3>
            <input type="text" value="Alex" />
          </div>

          <div class="section">
            <h3>Default currency (required)</h3>
            <input type="text" value="CAD" />
          </div>
        </div>

        <div class="right-stack">
          <div class="card">
            <h2>File preview (5 rows)</h2>

            <div style="margin-top: 12px; overflow: auto; border: 1px solid var(--border); border-radius: 14px">
              <table>
                <thead>
                  <tr>
                    <th>
                      <div class="col-title">Date</div>
                      <div class="col-controls">
                        <select class="roleSelect" data-col="Date">
                          <option>Ignore</option>
                          <option selected>Date</option>
                          <option>Description</option>
                          <option>Money (signed)</option>
                          <option>Money out</option>
                          <option>Money in</option>
                          <option>Direction (in/out)</option>
                          <option>Account</option>
                          <option>Currency</option>
                        </select>
                      </div>
                    </th>
                    <th>
                      <div class="col-title">Payee</div>
                      <div class="col-controls">
                        <select class="roleSelect" data-col="Payee">
                          <option>Ignore</option>
                          <option>Date</option>
                          <option selected>Description</option>
                          <option>Money (signed)</option>
                          <option>Money out</option>
                          <option>Money in</option>
                          <option>Direction (in/out)</option>
                          <option>Account</option>
                          <option>Currency</option>
                        </select>
                      </div>
                    </th>
                    <th>
                      <div class="col-title">Memo</div>
                      <div class="col-controls">
                        <select class="roleSelect" data-col="Memo">
                          <option>Ignore</option>
                          <option>Date</option>
                          <option selected>Description</option>
                          <option>Money (signed)</option>
                          <option>Money out</option>
                          <option>Money in</option>
                          <option>Direction (in/out)</option>
                          <option>Account</option>
                          <option>Currency</option>
                        </select>
                      </div>
                    </th>
                    <th>
                      <div class="col-title">Amount</div>
                      <div class="col-controls">
                        <div class="inline">
                          <select class="roleSelect" data-col="Amount">
                            <option>Ignore</option>
                            <option>Date</option>
                            <option>Description</option>
                            <option selected>Money (signed)</option>
                            <option>Money out</option>
                            <option>Money in</option>
                            <option>Direction (in/out)</option>
                            <option>Account</option>
                            <option>Currency</option>
                          </select>
                          <div
                            class="tiny-toggle"
                            data-kind="amountFlip"
                            data-on="false"
                            title="Flip sign. Use this if your file shows spending as positive numbers."
                          >
                            ±
                          </div>
                          <span
                            class="hint"
                            title="Tip: Preview amounts show the sign via color (green = income, red = spending). Use ± to flip if your file uses + for spending. If you map Direction (in/out), Cashmop ignores the sign and uses Direction to choose +/-."
                            >?</span
                          >
                        </div>
                      </div>
                    </th>
                    <th>
                      <div class="col-title">Currency</div>
                      <div class="col-controls">
                        <select class="roleSelect" data-col="Currency">
                          <option>Ignore</option>
                          <option>Date</option>
                          <option>Description</option>
                          <option>Money (signed)</option>
                          <option>Money out</option>
                          <option>Money in</option>
                          <option>Direction (in/out)</option>
                          <option>Account</option>
                          <option selected>Currency</option>
                        </select>
                      </div>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>2026-01-02</td>
                    <td>GROCERY</td>
                    <td>SAFEWAY #112</td>
                    <td><span class="amt expense">86.12</span></td>
                    <td>CAD</td>
                  </tr>
                  <tr>
                    <td>2026-01-06</td>
                    <td>PAYROLL</td>
                    <td>ACME INC</td>
                    <td><span class="amt income">3000.00</span></td>
                    <td>CAD</td>
                  </tr>
                  <tr>
                    <td>2026-01-10</td>
                    <td>STARBUCKS</td>
                    <td>VANCOUVER</td>
                    <td><span class="amt expense">5.25</span></td>
                    <td>CAD</td>
                  </tr>
                  <tr>
                    <td>2026-01-14</td>
                    <td>REFUND</td>
                    <td>UBER</td>
                    <td><span class="amt income">18.40</span></td>
                    <td>CAD</td>
                  </tr>
                  <tr>
                    <td>2026-01-18</td>
                    <td>UBER</td>
                    <td>TRIP</td>
                    <td><span class="amt expense">18.40</span></td>
                    <td>CAD</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <h2>Import</h2>

            <div class="section">
              <h3>Months (per file)</h3>
              <div class="months" id="months">
                <div class="chip" data-selected="false">Dec 2025</div>
                <div class="chip" data-selected="true">Jan 2026</div>
                <div class="chip" data-selected="false">Feb 2026</div>
              </div>
            </div>

            <div class="section">
              <h3>Remember mapping</h3>
              <div class="row" style="margin-top: 10px">
                <label style="margin: 0"><input type="radio" name="remember" /> Off</label>
                <label style="margin: 0"><input type="radio" name="remember" checked /> Save as new</label>
                <label style="margin: 0"><input type="radio" name="remember" /> Update selected</label>
              </div>
              <div style="margin-top: 10px">
                <label>Mapping name</label>
                <input type="text" value="RBC Checking (new)" />
              </div>
            </div>

            <div class="cta">
              <button class="primary" type="button" id="importBtn">Import this file → Next file</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Tiny “interactive” touches to communicate intent.
      // Month chips
      document.getElementById("months").addEventListener("click", (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        chip.dataset.selected = chip.dataset.selected === "true" ? "false" : "true";
      });

      // Tiny flip toggles
      for (const t of document.querySelectorAll(".tiny-toggle")) {
        t.addEventListener("click", () => {
          t.dataset.on = t.dataset.on === "true" ? "false" : "true";
        });
      }

      // Description order drag/drop list (simple)
      const list = document.getElementById("descList");
      let dragEl = null;
      list.addEventListener("dragstart", (e) => {
        const li = e.target.closest(".desc-item");
        if (!li) return;
        dragEl = li;
        e.dataTransfer.effectAllowed = "move";
      });
      list.addEventListener("dragover", (e) => {
        e.preventDefault();
        const over = e.target.closest(".desc-item");
        if (!over || !dragEl || over === dragEl) return;
        const rect = over.getBoundingClientRect();
        const before = e.clientY < rect.top + rect.height / 2;
        list.insertBefore(dragEl, before ? over : over.nextSibling);
      });
      list.addEventListener("dragend", () => {
        dragEl = null;
      });

      // Sequential file punch-through: clicking import advances “File N of M” in the mock.
      const fileNames = ["rbc_export.csv", "wise_export.csv"];
      let idx = 0;
      const renderFile = () => {
        document.getElementById("fileName").textContent = fileNames[idx];
        document.getElementById("fileProgress").textContent = `File ${idx + 1} of ${fileNames.length}`;
        const btn = document.getElementById("importBtn");
        btn.textContent =
          idx < fileNames.length - 1 ? "Import this file → Next file" : "Import this file (last one)";
      };
      renderFile();
      document.getElementById("importBtn").addEventListener("click", () => {
        if (idx >= fileNames.length - 1) {
          alert("Imported last file (mock). Next: show Import complete state.");
          return;
        }
        idx += 1;
        renderFile();
      });
    </script>
  </body>
</html>
